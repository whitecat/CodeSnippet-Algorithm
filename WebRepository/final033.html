<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>  Java annoyance: final parameters | meta/LPAR</title>
<meta name="generator" content="WordPress 2.9.1" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="author" content="" />
<link rel="stylesheet" href="http://lpar.ath0.com/wp-content/themes/darkpink-reload-21/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="meta/LPAR RSS Feed" href="http://lpar.ath0.com/feed/" />
<link rel="pingback" href="http://lpar.ath0.com/xmlrpc.php" />

<link rel="alternate" type="application/rss+xml" title="meta/LPAR &raquo; Java annoyance: final parameters Comments Feed" href="http://lpar.ath0.com/2008/08/26/java-annoyance-final-parameters/feed/" />
<link rel='stylesheet' id='openid-css'  href='http://lpar.ath0.com/wp-content/plugins/openid/f/openid.css?ver=519' type='text/css' media='all' />
<script type='text/javascript' src='http://lpar.ath0.com/wp-includes/js/jquery/jquery.js?ver=1.3.2'></script>
<script type='text/javascript' src='http://lpar.ath0.com/wp-content/plugins/openid/f/openid.js?ver=519'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://lpar.ath0.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://lpar.ath0.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='meta/LPAR' href='http://lpar.ath0.com' />
<link rel='start' title='IPL' href='http://lpar.ath0.com/2008/07/12/welcome/' />
<link rel='prev' title='Java: not all that bad these days' href='http://lpar.ath0.com/2008/08/26/java-not-all-that-bad-any-more/' />
<link rel='next' title='A wakeup call for commercial Linux' href='http://lpar.ath0.com/2008/09/01/a-wakeup-call-for-commercial-linux/' />
<meta name="generator" content="WordPress 2.9.1" />
<link rel='canonical' href='http://lpar.ath0.com/2008/08/26/java-annoyance-final-parameters/' />

</head>
<body>

<div id="wrapper">

	<ul id="pagine">
		<li><a href="http://lpar.ath0.com/" title="meta/LPAR">Home page</a></li>
		<li class="page_item page-item-2"><a href="http://lpar.ath0.com/about/" title="About">About</a></li>
	</ul>

	<div id="header">

		<h1>Home Page</h1>

		<h2><a href="http://lpar.ath0.com/" title="meta/LPAR">meta/LPAR</a></h2>
	
		<div class="description">Thinking inside the Big Blue box.</div>

	</div>

	<hr />

	<div id="sidebar">

	<h1>Sidebar</h1>

	<ul>
		<li id="search-2" class="widget widget_search"><form method="get" id="searchform" action="http://lpar.ath0.com/">
<div><input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</li>
<li id="calendar-2" class="widget widget_calendar"><h2 class="widgettitle">&nbsp;</h2>
<div id="calendar_wrap"><table id="wp-calendar" summary="Calendar">
	<caption>August 2008</caption>
	<thead>
	<tr>
		<th abbr="Monday" scope="col" title="Monday">M</th>
		<th abbr="Tuesday" scope="col" title="Tuesday">T</th>
		<th abbr="Wednesday" scope="col" title="Wednesday">W</th>
		<th abbr="Thursday" scope="col" title="Thursday">T</th>
		<th abbr="Friday" scope="col" title="Friday">F</th>
		<th abbr="Saturday" scope="col" title="Saturday">S</th>
		<th abbr="Sunday" scope="col" title="Sunday">S</th>
	</tr>
	</thead>

	<tfoot>
	<tr>
		<td abbr="July" colspan="3" id="prev"><a href="http://lpar.ath0.com/2008/07/" title="View posts for July 2008">&laquo; Jul</a></td>
		<td class="pad">&nbsp;</td>
		<td abbr="September" colspan="3" id="next"><a href="http://lpar.ath0.com/2008/09/" title="View posts for September 2008">Sep &raquo;</a></td>
	</tr>
	</tfoot>

	<tbody>
	<tr>
		<td colspan="4" class="pad">&nbsp;</td><td><a href="http://lpar.ath0.com/2008/08/01/" title="It&#8217;s all about solving problems">1</a></td><td>2</td><td>3</td>
	</tr>
	<tr>
		<td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td><a href="http://lpar.ath0.com/2008/08/09/" title="JavaScript: The Good Parts">9</a></td><td>10</td>
	</tr>
	<tr>
		<td><a href="http://lpar.ath0.com/2008/08/11/" title="Looking for debug information in all the wrong places">11</a></td><td>12</td><td>13</td><td>14</td><td>15</td><td>16</td><td>17</td>
	</tr>
	<tr>
		<td>18</td><td>19</td><td>20</td><td>21</td><td><a href="http://lpar.ath0.com/2008/08/22/" title="The dark romance of computer science">22</a></td><td>23</td><td>24</td>
	</tr>
	<tr>
		<td>25</td><td><a href="http://lpar.ath0.com/2008/08/26/" title="Java: not all that bad these days, Java annoyance: final parameters">26</a></td><td>27</td><td>28</td><td>29</td><td>30</td><td>31</td>
	</tr>
	</tbody>
	</table></div></li>
		<li id="recent-posts-2" class="widget widget_recent_entries">		<h2 class="widgettitle">Recent Posts</h2>
		<ul>
				<li><a href="http://lpar.ath0.com/2010/01/31/ruby-packages-chaos-and-confusion/" title="Ruby packages: chaos and confusion">Ruby packages: chaos and confusion </a></li>
				<li><a href="http://lpar.ath0.com/2009/12/23/the-curse-of-microsoft-strikes-again/" title="The Curse of Microsoft strikes again">The Curse of Microsoft strikes again </a></li>
				<li><a href="http://lpar.ath0.com/2009/12/01/the-case-of-the-null-empty-nothing/" title="The case of the Null Empty Nothing">The case of the Null Empty Nothing </a></li>
				<li><a href="http://lpar.ath0.com/2009/11/20/rpm-cheat-sheet/" title="RPM cheat sheet">RPM cheat sheet </a></li>
				<li><a href="http://lpar.ath0.com/2009/11/05/att-global-network-client-agnclient-and-ubuntu-9-10/" title="AT&amp;T Global Network Client (agnclient) and Ubuntu 9.10">AT&#038;T Global Network Client (agnclient) and Ubuntu 9.10 </a></li>
				</ul>
		</li>
<li id="categories-384428351" class="widget widget_categories"><h2 class="widgettitle">Categories</h2>
		<ul>
	<li class="cat-item cat-item-62"><a href="http://lpar.ath0.com/category/programming/java/annoyances/" title="View all posts filed under Annoyances">Annoyances</a>
</li>
	<li class="cat-item cat-item-140"><a href="http://lpar.ath0.com/category/business/" title="View all posts filed under Business">Business</a>
</li>
	<li class="cat-item cat-item-28"><a href="http://lpar.ath0.com/category/career/" title="View all posts filed under Career">Career</a>
</li>
	<li class="cat-item cat-item-10"><a href="http://lpar.ath0.com/category/culture/" title="What it&#039;s really like at IBM">Culture</a>
</li>
	<li class="cat-item cat-item-41"><a href="http://lpar.ath0.com/category/design/" title="View all posts filed under Design">Design</a>
</li>
	<li class="cat-item cat-item-16"><a href="http://lpar.ath0.com/category/domino/" title="View all posts filed under Domino">Domino</a>
</li>
	<li class="cat-item cat-item-23"><a href="http://lpar.ath0.com/category/programming/java/" title="View all posts filed under Java">Java</a>
</li>
	<li class="cat-item cat-item-52"><a href="http://lpar.ath0.com/category/programming/javascript/" title="View all posts filed under JavaScript">JavaScript</a>
</li>
	<li class="cat-item cat-item-26"><a href="http://lpar.ath0.com/category/linux/" title="View all posts filed under Linux">Linux</a>
</li>
	<li class="cat-item cat-item-108"><a href="http://lpar.ath0.com/category/macintosh/" title="View all posts filed under Macintosh">Macintosh</a>
</li>
	<li class="cat-item cat-item-75"><a href="http://lpar.ath0.com/category/microsoft/" title="View all posts filed under Microsoft">Microsoft</a>
</li>
	<li class="cat-item cat-item-53"><a href="http://lpar.ath0.com/category/programming/" title="View all posts filed under Programming">Programming</a>
</li>
	<li class="cat-item cat-item-182"><a href="http://lpar.ath0.com/category/programming/ruby/" title="View all posts filed under Ruby">Ruby</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://lpar.ath0.com/category/standards/" title="Open standards are what makes the Internet work">Standards</a>
</li>
	<li class="cat-item cat-item-112"><a href="http://lpar.ath0.com/category/system-administration/" title="View all posts filed under System administration">System administration</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://lpar.ath0.com/category/uncategorized/" title="View all posts filed under Uncategorized">Uncategorized</a>
</li>
		</ul>
</li>
	</ul>
</div>

	<hr />

	<div id="content">
	
		<h1>Main Contents</h1>


	
		<div class="post" id="post-55">
			<h2><a href="http://lpar.ath0.com/2008/08/26/java-annoyance-final-parameters/" rel="bookmark" title="Permalink: Java annoyance: final parameters">Java annoyance: final parameters</a></h2>
			<p class="date">August 26, 2008</p>
			
			<p>First, the summary:</p>
<p><b>Q: What does it mean when a method I&#8217;m calling declares that its parameters are final?</b><br />
A: To you, nothing. It&#8217;s a safety feature for the author of the method.</p>
<p><b>Q: OK, so when should I declare method parameters as final?</b><br />
A: Absolutely always.</p>
<p><b>Q: Isn&#8217;t that just annoying busywork?</b><br />
A: Pretty much so, yes. You must be new to Java.</p>
<p>And now, the lengthy discussion.</p>
<p><span id="more-55"></span></p>
<p>Way back in the days when the closest thing to a decent programming language available to me was C or Pascal, I disliked functions with <a href="http://en.wikipedia.org/wiki/Side_effect_(computer_science)">side effects</a>. At the time they mostly seemed to me to be a nasty hack to get around the fact that there was no easy syntax for returning multiple values.</p>
<p>Today, I&#8217;m even less of a functional programmer than I was in college; but I still see functions with side effects on their arguments as evil. Sometimes a necessary evil for performance reasons, but evil nevertheless. (Obviously side effects on an object by its own methods aren&#8217;t anywhere near as big of a problem, though I like that Ruby distinguishes them from side-effect-free methods by a special naming convention.)</p>
<p>So my deeply ingrained habit is to treat function/method parameters as unmodifiable, whatever the programming language. I had actually forgotten that this was a habit until I started running PMD on my Java code, and promptly had it warn me that every single method parameter ought to be declared <code>final</code>. This in turn made me think about Java&#8217;s method call semantics, and how badly chosen and useless the word &quot;final&quot; is on method parameters.</p>
<p>In C and C++, the <code>const</code> keyword is used all the time when library functions accept string parameters, and provides the caller with a guarantee that the function will not modify the string. For example:</p>
<pre><code>int strcmp(const char *s1, const char *s2);</code></pre>
<p>You might naively expect that in Java, <code>final</code> performs a similar function&#8211;but it doesn&#8217;t really.</p>
<p>First off, in Java all Strings are immutable. So whether arguments are final or not, your strings will never be modified by being passed to a method.</p>
<p>Secondly, in Java all objects are passed as a value consisting of a pointer to the object. The Java <code>Thing a</code> is really like C++ <code>Thing *a</code>, and Java&#8217;s <code>a.method()</code> is really C++&#8217;s <code>a-&gt;method()</code>, <strong>not</strong> <code>a.method()</code>.</p>
<p>To look at it the other way, if you could have an actual object in a variable x, Java&#8217;s <code>foo(x)</code> would really be doing a C++ <code>foo(&amp;x)</code>&#8211;but in Java, you never get to touch the actual object x.</p>
<p>It seems that the designers of Java wanted to make sure nobody confused their object pointers with the evil manipulable pointers of C and C++, so they decided to call them references instead. So Java books usually say that objects are stored as references, leading people to think that objects are passed by reference. They&#8217;re not, they&#8217;re passed by value, it&#8217;s just that the value is a pointer. If you&#8217;re confused again, try going back a couple of paragraphs.</p>
<p>Anyhow, the upshot of pass-by-value with objects represented by pointer values, is that as a caller of a Java method, the presence or absence of <code>final</code> on parameters tells you absolutely nothing. Even if the parameters are all final, the method can still modify the value of any objects you pass in, unless the objects themselves are special immutable ones like the String class. Contrariwise, even if the parameters aren&#8217;t final, the method can&#8217;t make your variables end up pointing at a different object.</p>
<p>This is undoubtedly why JavaDoc ignores <code>final</code> on parameters when generating documentation.</p>
<p>What about the value to the author of the method? Well, reassigning parameters is pretty much universally viewed as a bad thing to do, and Eclipse will warn you about it.</p>
<p>If you&#8217;re not convinced it&#8217;s unwise, consider the case where you have a constructor with a parameter &#8216;name&#8217; that gets set as the initial value of a field, also called &#8216;name&#8217;. If parameters are final, there&#8217;s no way to accidentally modify the parameter when you think you&#8217;re modifying the field. Yes, Eclipse warns about parameters masking fields too, but still&#8230; more safety is good if the cost is low.</p>
<p>So let&#8217;s consider what would happen if we made all parameters <code>final</code> by default.</p>
<p>There may be a rare occasion where you genuinely need to change values passed in to a method before performing some computation. Since every object in Java is manipulated as a pointer, it&#8217;s computationally trivial to introduce a temporary variable that&#8217;s a copy of the parameter, and then either change it to point to a different object or not. So instead of</p>
<pre><code>void foo(Object x) {if (x == null) { x = SOME_DEFAULT; }...}</code></pre>
<p>you&#8217;d have to do</p>
<pre><code>void foo(Object x) {Object c = x;if (c == null) { c = SOME_DEFAULT; }}</code></pre>
<p>No big problem.</p>
<p>How about performance? Well, it turns out that the final-ness of parameters isn&#8217;t part of the method signature. I also checked, and the compiled class files are byte-identical whether your parameters are final or not. So, no performance benefit either way.</p>
<p>Finally, no pun intended, the use of <code>final</code> on parameters is required when using inner (nested) classes for listeners or iteration. This crops up all the time in Swing programming, and a Google search shows that it&#8217;s a common cause of intense confusion.</p>
<p>So I don&#8217;t see any value to making the final-ness of parameters a matter of choice for method authors either. They should all be final, always. You won&#8217;t see any significant performance change, but you&#8217;ll get a bit more safety, and you&#8217;ll be a bit less likely to encounter a weird error message when attempting to use listeners and iterators.</p>
<p>So the actual word <code>final</code> on method parameters is just noise, providing no benefit to API users, programmers with good coding habits, or anyone using a tool like Eclipse that warns about reassigning parameter variables. The language <em>should</em> have made final parameters at least the default, and ideally the only option. It annoys me that I end up with my method declarations cluttered with <code>final</code>, <code>final</code>, <code>final</code>.</p>
							
				<p class="details_small">
					Filed under: <a href="http://lpar.ath0.com/category/programming/java/annoyances/" title="View all posts in Annoyances" rel="category tag">Annoyances</a> | 
					 
					<a href="http://lpar.ath0.com/2008/08/26/java-annoyance-final-parameters/#comments" title="Comment on Java annoyance: final parameters">Comments (3)</a>				</p>
			
					</div>
		
		

	<h3 id="comments">3 Comments</h3>
	<ol class="commentlist">

		
			<li class="alt" id="comment-10">
								<big>gareth</big>
								
				<span class="comment_data"><a href="#comment-10" title="">August 27, 2008 @ 19:42</a> </span>

				<p><i>[In C++, const] provides the caller with a guarantee that the function will not modify the string</i></p>
<p>The guarantee is that the function will not modify the string <b>through the const pointer</b>. It&#8217;s allowed to modify the string by other means, e.g. by casting the pointer so as to remove the const qualifier.</p>

			</li>

			
		
			<li class="" id="comment-11">
								<big>meta</big>
								
				<span class="comment_data"><a href="#comment-11" title="">August 27, 2008 @ 20:14</a> </span>

				<p>True. Which goes back to why Java wanted to hide pointers from programmers.</p>

			</li>

			
		
			<li class="alt" id="comment-33">
								<big><a href='https://me.yahoo.com/a/LNOPZnsuitTW.51pd_lDzjXJV2zR#b7a12' rel='external nofollow' class='openid_link url'>me.yahoo.com/a/LNOPZnsuiâ?¦</a></big>
								
				<span class="comment_data"><a href="#comment-33" title="">April 8, 2009 @ 14:37</a> </span>

				<p>Am I the only one who thinks Java should have something like C++&#8217;s Const concept?</p>
<p>The &#8216;final&#8217; word reffers to the Reference, so the &#8216;const&#8217; word should reffer to the Value.<br />
Why? Because one of the Java&#8217;s main concept is that some errors *must* appear in compile time.</p>
<p>Imagine:<br />
public void alterObj(User user){&#8230;}<br />
public String readFromObj(const User user){&#8230;}</p>
<p>class User{<br />
   public String getName() const;<br />
   public String setName();<br />
}</p>
<p>Sure, this would not be compatible with current sources, I know.<br />
But that&#8217;s somthing I miss from C++.</p>

			</li>

			
		
	</ol>



	<h3 id="respond">Leave a comment</h3>

	
		<p><a href="http://lpar.ath0.com/wp-login.php?redirect_to=http://lpar.ath0.com/2008/08/26/java-annoyance-final-parameters/">Login</a></p>

	

				<div class="navigation">
			<span class="alignleft">&laquo; <a href="http://lpar.ath0.com/2008/08/26/java-not-all-that-bad-any-more/" rel="prev">Java: not all that bad these days</a></span>
			<span class="alignright"><a href="http://lpar.ath0.com/2008/09/01/a-wakeup-call-for-commercial-linux/" rel="next">A wakeup call for commercial Linux</a> &raquo;</span>
		</div>
	


	</div>

	<hr />

	<div id="footer">
		<h1>Footer</h1> 
		<p>Powered by <a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">Wordpress</a> and <a href="http://www.idsg.it/" title="ShinRa House Theme">ShinRa House</a></p>
	</div>

</div>


</body>
</html>
<!-- Dynamic page generated in 0.631 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2010-02-04 10:22:22 -->
