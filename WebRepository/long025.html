<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /> 
<title>When long is not long enough | Java.net</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="alternate" type="application/atom+xml" title="Java.net Atom" href="/node/271575/atom/feed" />
<link rel="shortcut icon" href="/misc/favicon.ico" type="image/x-icon" />

<link type="text/css" rel="stylesheet" media="all" href="/sites/default/files/css/css_8bdbecf0b14b91267642d81949afff6d.css" />
<!--[if IE]>
<link rel="stylesheet" href="/sites/all/themes/java/ie.css" />
<![endif]-->
<style>
#edit-taxonomy-6-wrapper{display:none} /*feed category*/
</style>

<style>
#edit-taxonomy-4-wrapper{display:none} /*comm homepage*/
</style>


<link rel="shortcut icon" href="http://community.java.net/favicon.ico">
<!--  Begin SiteCatalyst code  -->
<script language="JavaScript">
<!--
var s_channel="other";
//--></script>
<!--  End SiteCatalyst code  -->
</head>
<body id="page-body" leftmargin="0" topmargin="0" rightmargin="0" bgcolor="#ffffff" marginheight="0" marginwidth="0">
<a name="top"></a>
<div class="topline">
  <div class="topbar">
    <table border="0" cellpadding="0" cellspacing="0" height="25" width="100%">
      <tbody>
        <tr>
          <td rowspan="2" width="100%"><a href="http://www.java.net/"><img src="/images/header_jnet_new.jpg" alt="The Source for Java Technology Collaboration" border="0" height="60" width="500"></a></td>
          <td style="vertical-align: middle;" nowrap="nowrap"><div id="login">
          	              <form name="loginform" id="loginform" action="https://www.dev.java.net/servlets/TLogin" method="post">
                <input name="redir" value="http://www.java.net/blog/kohsuke/archive/2009/09/17/when-long-not-long-enough" type="hidden">
                <div> <strong>User:</strong>
                  <input name="loginID" id="loginID" value="" size="7" maxlength="32" type="text">
                  <strong>Password:</strong>
                  <input name="password" id="password" value="" size="7" maxlength="32" type="password">
                  <input name="Login" class="buttonred" id="Button" value="Login" type="submit">
                </div>
                <div class="small" align="right"><strong> <a href="https://www.dev.java.net/servlets/Join">Register</a> | <a href="https://www.dev.java.net/servlets/TLogin">Login help</a> &nbsp;&nbsp;&nbsp;</strong>
						</div>
              </form>
            </div></td>
        </tr>
      </tbody>
    </table>
  </div>
  <noindex>
    <div class="tabs" id="toptabs">
      <table border="0" cellpadding="4" cellspacing="0">
        <tbody>
          <tr>
            <!-- make the active tab a TH instead of TD -->
            <td><a href="https://www.dev.java.net/servlets/StartPage">My pages</a> </td>
            								<td><a href="http://www.java.net/projects/">Projects</a></td>
                <td><a href="http://www.java.net/community">Communities</a> </td>
                <th><a href="http://www.java.net/">java.net</a></th>
							          </tr>
        </tbody>
      </table>
    </div>
  </noindex>

  <table id="main" border="0" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr valign="top">
        <td id="leftcol" rowspan="2" width="170">
           <div id="block-menu-menu-get-involved" class="clear-block block block-menu">

  <h2>Get Involved</h2>

  <div class="content"><ul class="menu"><li class="leaf first"><a href="/about-javanet" title="About java.net">About java.net</a></li>
<li class="leaf"><a href="/request-project" title="Request a Project">Request a Project</a></li>
<li class="leaf"><a href="/publicize-your-project" title="Publicize your Project">Publicize your Project</a></li>
<li class="leaf"><a href="/submit-content" title="Submit Content">Submit Content</a></li>
<li class="leaf"><a href="https://java-net.dev.java.net/" title="">java-net Project</a></li>
<li class="leaf"><a href="/enhancements" title="">Java.net Enhancements</a></li>
<li class="leaf"><a href="https://www.dev.java.net/servlets/OpenCollabNet" title="">Site Help</a></li>
<li class="leaf last"><a href="/form/report-inappropriate-content" title="Report Inappropriate Content">Report Inappropriate Content</a></li>
</ul></div>
</div>
<div id="block-menu-menu-get-informed" class="clear-block block block-menu">

  <h2>Get Informed</h2>

  <div class="content"><ul class="menu"><li class="leaf first"><a href="/articles" title="">Articles</a></li>
<li class="leaf"><a href="/blogfront" title="">Blogs</a></li>
<li class="leaf"><a href="/events" title="">Events</a></li>
<li class="leaf"><a href="http://safari.java.net/" title="">java.net Online Books</a></li>
<li class="leaf last"><a href="/today/archive" title="Archive">java.net Archives</a></li>
</ul></div>
</div>
<div id="block-menu-menu-get-connected" class="clear-block block block-menu">

  <h2>Get Connected</h2>

  <div class="content"><ul class="menu"><li class="leaf first"><a href="http://forums.java.net/" title="">java.net Forums</a></li>
<li class="leaf"><a href="http://wiki.java.net" title="">Wiki</a></li>
<li class="leaf"><a href="http://wiki.java.net/bin/view/Javapedia/WebHome" title="">Javapedia</a></li>
<li class="leaf"><a href="http://wiki.java.net/bin/view/People/WebHome" title="">People</a></li>
<li class="leaf"><a href="/partners" title="">Partners</a></li>
<li class="leaf"><a href="http://wiki.java.net/bin/view/Javanet/JobsWiki" title="">Jobs</a></li>
<li class="leaf"><a href="/pub/q/rsschannels" title="">RSS Feeds</a></li>
<li class="leaf last"><a href="/jugs-list">Java User Groups</a></li>
</ul></div>
</div>
<div id="block-block-1" class="clear-block block block-block">

  <h2>Search</h2>

  <div class="content"><form action="http://www.google.com/cse" id="cse-search-box">
                  <div>Web and Projects:</div>
                  <div>
                   <input type="text" name="q" size="22" />
                   <input type="hidden" name="cx" value="017555676512375062942:o5-kz1r0m2s" />
                   <input type="hidden" name="ie" value="UTF-8" />
                    <input type="submit" name="sa" value="Search" />
                  </div>
                </form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>



            <!--<script type="text/javascript" src="/images/brand.htm"></script>-->
                <div>Online Books:</div>
                <form action="http://safari.java.net/search" method="post" name="searchForm" id="form_searchForm">
                  <input name="__formName" value="searchForm" type="hidden">
                  <input value="simple" name="searchmode" id="searchmode" type="hidden">
                  <input value="0" name="page" id="page" type="hidden">
                  <input value="summary" name="searchview" id="searchview" type="hidden">
                  <input value="rank" name="sort" id="sort" type="hidden">
                  <input value="desc" name="order" id="order" type="hidden">
                  <input value="1" name="NewSearch" id="NewSearch" type="hidden">
                  <div>
                    <input name="searchtextbox" id="searchtextbox" value="" class="medium" size="14" type="text">
                    <input class="buttonred" value=" » " border="0" type="submit">
                  </div>
                </form>
                <div>java.net on <a href="http://markmail.org/">MarkMail</a>:</div>
                <form action="http://markmail.org/search/list:net.java">
                  <div>
                    <input name="q" id="searchtextbox" value="" class="medium" size="14" type="text">
                    <input class="buttonred" value=" » " border="0" type="submit">
                  </div>
                </form>
                <div><a href="http://www.java.net/search">Advanced Search</a></div>
</div>
</div>
        </td>
        <td colspan="2" height="3"><img src="/images/a.gif" height="3" width="1"><br></td>
      </tr>
      <tr>
        <td width="10"><img src="/images/a.gif" height="1" width="10"></td>
        <td valign="top" width="100%">
          <br>
          <a name="skip2content"></a>
          	            	<div id="content-top">
              	<div id="block-block-20" class="clear-block block block-block">


  <div class="content"><div id="blog-author-top"><table><tr><td><div id="blog-author-body"><img align="left" src="/images/people/kohsuke_kawaguchi.jpg" border="0" /></div></td><td valign="top"><h2><a href="/blog/108">Kohsuke Kawaguchi</a></h2><div id="blog-nav-links"><a href="/blog/kohsuke/archive/2009/09/04/see-you-javazone">See you at JavaZone</a> | <a href="/blog/108">Main</a> | <a href="/blog/kohsuke/archive/2009/09/21/project-day-openid-javanet">Project of the day: OpenID for Java.net</a></div></td></tr></table><div id="blog-author-feedlink2"><a href="/blog/108/feed"><img src="/misc/feed.png" border="0" /></a></div></div><div style="clear:both"></div><div style="border-bottom: 4px #eee solid;">&nbsp;</div></div>
</div>
              </div>
            						                          <h2 class="title">When long is not long enough</h2>
                                                <style>
#edit-taxonomy-6-wrapper{display:none} /*feed category*/
</style>

<style>
#edit-taxonomy-4-wrapper{display:none} /*comm homepage*/
</style>

  <div class="blog-node node">
          <div id="blog-submitted">Posted by <a href="/blog/108">kohsuke</a> on September 17, 2009 at 3:07 PM PDT</div>  
  <div class="content"><span class='print-link'></span><p>Yesterday, a Hudson committer Alan Harder discovered an <tt>EOFException</tt> in Hudson, which only happens on 64bit JVM on Solaris. This was happening in the part of Hudson (or more precisely, in a separate library called <a href="https://akuma.dev.java.net/">Akuma</a>) where we look at the memory space of the process to figure out the command line arguments of the current process (the <tt>/proc/ID/as</tt> file &mdash; an equivalent of <tt>/proc/ID/mem</tt> in Linux)</p>
<p>It turns out that the problem was because this sparse file is 2<sup>64</sup> bytes long on 64bit systems. So for Hudson to look at arbitrary positions in the process memory space,  it needs be able to seek beyond <tt>Long.MAX_VALUE</tt> (2<sup>63</sup>-1.)</p>
<p>Java's <tt>RandomAccessFile</tt> has the <tt>seek(long)</tt> method, but it uses <tt>long</tt> as a signed value (as it should), so this won't do it. Alan suggested that we first seek to 2<sup>63</sup>-1 and then call <tt>skipBytes</tt> repeatedly till we get to where we want. This won't do it either, unfortunately, because <tt>skipBytes</tt> takes <tt>int</tt>. I'd have to call this method for close to 2<sup>32</sup> times in the worst case! (And it turns out that internally <tt>RandomAccessFile</tt> keeps the file offset in a single <tt>long</tt> field, so it just can't address anything above 2<sup>63</sup>-1 anyway.)</p>
<p>So to do this, I had to go back to <tt>libc</tt>, namely <tt>fseek</tt>. It still uses a signed long, but with <tt>fseek</tt>, one could say &quot;move ahead by 2<sup>63</sup>-1 from the current position&quot;, so in the worst case, it takes up to 3 seeks to get to where I want, but I was finally able to fix the problem that way.</p>
<p>Now, the maximum file size in <a href="http://en.wikipedia.org/wiki/ZFS">ZFS</a> is 2<sup>128</sup> bytes &mdash; I wonder how one would seek to an arbitrary position in such a large file!</p></div>
    <div class="links">&raquo; <ul class="links inline"><li class="blog_usernames_blog first"><a href="/blog/kohsuke" title="Read kohsuke&#039;s latest blog entries.">kohsuke&#039;s blog</a></li>
<li class="comment_forbidden"><span><a href="/user/login?destination=comment%2Freply%2F271575%23comment-form">Login</a> or <a href="/user/register?destination=comment%2Freply%2F271575%23comment-form">register</a> to post comments</span></li>
<li class="statistics_counter"><span>2325 visits</span></li>
<li class="print_html last"><a href="/print/271575" title="Display a printer-friendly version of this page." class="print-page" rel="nofollow">Printer-friendly version</a></li>
</ul></div>    <div class="taxonomy">Related Topics &gt;&gt; 
	<a href="/blogs/topic/46">Blogs</a> &nbsp; &nbsp; &nbsp;<a href="/blogs/topic/57">J2SE</a> &nbsp; &nbsp; &nbsp;<a href="/blogs/community/95">Open JDK</a> &nbsp; &nbsp; &nbsp;    </div>  </div>
  <div id="comment-header">Comments</div>
  <div id="comment-header2">Comments are listed in date ascending order (oldest first)</div>
<div id="comments">
  <a id="comment-10567"></a>
<div class="comment comment-published clear-block">
  
  
  <h3><a href="/blog/kohsuke/archive/2009/09/17/when-long-not-long-enough#comment-10567" class="active">Back to the Problems of architeture diferences</a></h3>

  <div class="submitted">
    Submitted by levmatta on Fri, 2009-09-18 12:54.  </div>

  <div class="content">
    Java should take good notice of architeture changes and keep up, where is my 128bit value, and its corresponding double.
Arrays are still INTEGERS!!!!!!!
Soon we will have Char and Wchar (wait that should have already happend :-) )      </div>

  <ul class="links"><li class="comment_forbidden first last"><span><a href="/user/login?destination=comment%2Freply%2F271575%23comment-form">Login</a> or <a href="/user/register?destination=comment%2Freply%2F271575%23comment-form">register</a> to post comments</span></li>
</ul></div>
</div>
                                        <div id="content-bottomdiv2">
                	                </div>
                            
        </td>
              </tr>
      <tr>
        <td rowspan="2" valign="bottom"><img src="/images/a.gif" alt=" " border="0" height="1" width="170"><br>
        </td>
      </tr>
    </tbody>
  </table>

  <br>
  <img src="/images/a.gif" alt=" " border="0" height="1" width="170"><br>
  <img src="/images/a.gif" alt=" " border="0" height="1" width="170"><br>

  <table border="0" cellpadding="0" cellspacing="10" width="100%">
    <tbody>
      <tr>
        <td>&nbsp;
          <div class="grayline"></div>
          <table class="vatop" border="0" cellpadding="0" cellspacing="0" width="100%">
            <tbody>
              <tr>
                <td><img src="/images/a.gif" alt=" " border="0" height="1" width="190"><br>
                 &nbsp;&nbsp; <a href="http://www.oracle.com/"><img src="/images/logo_oracle_footer.gif" alt=" " border="0" vspace="5" ></a></td>
                <td valign="top" width="60%"><div class="footer">
                    <a href="https://java-net.dev.java.net/feedback.html">Feedback</a> &nbsp;|&nbsp;<a href="/javanet-faq">FAQ</a> &nbsp;|&nbsp;<a href="/javanet-web-site-terms-use">Terms of Use</a><br>
                    <a href="http://www.sun.com/privacy/">Privacy</a> &nbsp;|&nbsp; <a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;<a href="https://java-net.dev.java.net/sitemap.html">Site Map</a> <br>
                    <span class="sp5">&nbsp;</span><br>
                    Your use of this web site or any of its content or software indicates your agreement to be bound by these <a href="/javanet-web-site-terms-use">Terms of Participation</a>.<br>
                    <span class="sp5">&nbsp;</span><br>
                    Copyright &copy; 2010, Oracle and/or its affiliates. All rights reserved. Oracle and Java are registered trademarks of Oracle and/or its affiliates. Other names may be trademarks of their respective owners.</div></td>
                <td align="right" valign="top" width="40%"><div class="footer"> 
		<a href="http://www.collab.net/"><img src="/images/montague_logo_collabnet.gif" alt="Collabnet Logo" border="0" height="19" width="85"></a>
		<a href="http://www.cognisync.com/"><img src="/images/cognisync.jpg" alt="Cognisync Communities" border="0"></a>
<br>
                    Powered by Sun Microsystems, Inc.,<br>
                    CollabNet and Cognisync </div></td>
              </tr>
            </tbody>
          </table>
          <div class="grayline"></div></td>
      </tr>
    </tbody>
  </table>
  <!--  Begin SiteCatalyst code  -->
  <script language="JavaScript" src="/images/s_code_remote.js"></script>
  <!-- End SiteCatalyst code  -->
</div>
<div style="display:none"> </div>
<script type="text/javascript" src="/sites/default/files/js/js_a2d6e0eed2024ecdf79eb8f1b986333a.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "extlink": { "extTarget": "_blank", "extClass": 0, "extSubdomains": 1, "extExclude": "", "extInclude": "", "extAlert": 0, "extAlertText": "This link will take you to an external web site. We are not responsible for their content.", "mailtoClass": 0 }, "fivestar": { "titleUser": "Your rating: ", "titleAverage": "Average: ", "feedbackSavingVote": "Saving your vote...", "feedbackVoteSaved": "Your vote has been saved.", "feedbackDeletingVote": "Deleting your vote...", "feedbackVoteDeleted": "Your vote has been deleted." } });
//--><!]]>
</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-10612840-1");
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
